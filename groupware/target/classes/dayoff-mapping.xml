<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dayoff">

<!-- 	<resultMap type="DayoffCreateRecode" id="DayoffCreateRecode">
		<id property="employee_no" column="employee_no"/>
		<id property="generation_date" column="generation_date"></id>
		<result property="effect_day" column="effect_day" />
		<result property="real_day" column="real_day" />
		<result property="dayoff_type" column="dayoff_type" />
		<result property="dayoff_generatior" column="dayoff_generator"/>
	</resultMap> -->


	<select id="selectCreateTerms" resultType="DayoffCreateTerms">
		select * from
		dayoff_create_terms
	</select>

	<update id="updateCreateTerms" parameterType="DayoffCreateTerms">
		update
		dayoff_create_terms set dayoff_days = #{dayoff_days} where
		year_in_office = #{year_in_office}
	</update>

	<select id="selectDayoffKinds" resultType="DayoffKinds">
		select * from
		dayoff_kinds
	</select>

	<insert id="insertDayoffKinds" parameterType="DayoffKinds">
		insert into
		dayoff_kinds values
		(dayoff_type_code_seq.nextval,#{dayoff_name},#{dayoff_deduction},#{dayoff_activation})
	</insert>

	<select id="selectEmpDayoffDay" resultType="DayoffCreateRecode">
		select employee_no,
		dayoff_days as effect_day
		from employee join dayoff_create_terms dct
		on trunc(months_between(sysdate,hiredate)/12,0) = year_in_office
	</select>

	<insert id="insertAnnualDayoff" parameterType="DayoffCreateRecode">
		insert into dayoff_create_recode values (#{employee_no},sysdate,#{effect_day},#{effect_day} + (select nvl((select effect_day from dayoff_create_recode where generation_date = (select max(generation_date) from dayoff_create_recode where employee_no = #{employee_no} and dayoff_type=2)),0) from dual),1,2)
	</insert>
</mapper>